# DL-9 車載ソフトウェア完全性保証／SU法対応

## 概要

自動車やMaaS向けの車載コンピュータでは、オンラインでソフトウェアを更新する OTA (Over‑the‑Air) や、モジュール単位でハードウェア構成を変更することが一般化している。道路運送車両法や Software Update Requirement (SU 法) では、OEM が更新対象ソフトウェアの真正性と車両の構成を正しい状態で維持していることを証明する責任がある。本ユースケースでは、サプライヤーからの納品、OTA 配信、整備工場やオーナーによる更新作業という長いサプライチェーンを横断し、ソフトウェアとハードウェアの完全性を保証するトレーサビリティシステムを構築する。

## ビジネス課題

- 車載ソフトウェアやECU構成の改ざんを検出できなければ、リコール対応や法令遵守が困難で企業の社会的責任を果たせない。
- サプライヤー・工場・販売店・車両など複数主体が関与する更新履歴が分散しており、一元的に管理・監査できない。
- 鍵漏洩や不正改造の際に過去の配信ソフトウェアの再配信が必要となると、運用コストが高騰する。

## システム課題

- ソフトウェアの納品から車両への適用までの経路でデータ改ざんを防ぎ、記録したデータの改ざんを検知できる台帳が必要。
- サプライヤー、工場、販売店、車両ごとに鍵を割り当て、署名付きのデータのみを記録する仕組みが必要。秘密鍵漏洩時には新しい鍵にローテーションできることが求められる。
- 数百万台規模の車両データとリアルタイムなOTA更新に対応するため、スケールアウト可能でクラウド／データベース非依存のアーキテクチャを採用する必要がある。

## 対象データ・環境

- サプライヤーが納品するソフトウェアモジュールのバイナリ、電子署名、公的機関による公開鍵証明、ハッシュ値などの証拠データ。
- 車両のハードウェア構成情報（ECU 型番、部品番号、チップ情報など）とソフトウェアの適用履歴、再プログラム情報（リプロ情報）。
- クローズドネットワーク内の設計情報管理システム（PLM）、工場システム、販売店システム、およびインターネット経由の OTA サーバーや車両通信ネットワーク。

## 導入目的・効果

- SU 法やサイバーセキュリティ規則に準拠しながら、ソフトウェア更新履歴と構成情報を一元管理して証明できるようにする。
- 秘密鍵漏洩や不正な部品交換が発生しても、過去の配信物を再配信することなく安全を証明できるため運用コストを削減。
- 更新履歴と構成情報の透明性を高めることで、リコール対応やサービスキャンペーンの判断を迅速に行える。

## 解決方法（ソリューション概要）

### ソフトウェア証拠の記録

サプライヤーから納品されたソフトウェアに対し、電子署名・公開鍵・ハッシュ値・依存関係情報などをトレーサビリティ API 経由で ScalarDL の台帳に記録する。ScalarDL は独自のコンセンサスによって tamper‑evident なデータ管理を実現し（参考: [scalar-labs.com](https://scalar-labs.com)）、台帳と監査ノード（Auditor）を異なる管理ドメインに展開することでビザンチン故障検知を行える（参考: [scalardl.scalar-labs.com](https://scalardl.scalar-labs.com)）。記録された証拠は後から更新の正当性を検証する基盤となる。

### 配信ソフトウェアの検証

OTA サーバーや診断機が車両にソフトウェアを配信する際、車両は台帳から対応するハッシュ値と公開鍵を取得し、ダウンロードしたパッケージのハッシュと署名を照合する。照合に成功した場合のみ更新を許可し、不一致の場合は不正なソフトウェアとして拒否する。これにより配信経路での改ざんや偽装を検知する。

### 構成情報の履歴化と不正改造検出

車両は更新前後のハードウェア・ソフトウェア構成を収集し、自身の秘密鍵で署名したリプロ情報を送信する。トレーサビリティ API はこの情報を台帳に追記すると同時に、検索用の更新領域（RDB／NoSQL）に登録する。次回更新時には台帳に保存された前回構成情報と比較し、異なる部品や非認証モジュールが装着されていないか検証する。

### 鍵管理と再署名

サプライヤーや車両の秘密鍵が漏洩した場合でも、台帳に保存されたソフトウェア証拠を用いることで過去の配信物が改ざんされていないことを証明できる。新しい鍵で再署名した証拠を台帳に追記するだけで済み、ソフトウェアの再配布は不要となる。

### 同意管理と作業履歴

整備工場やオーナーが更新作業を行う際には、作業記録やオーナーの同意をフォーム入力から取得し、署名付きで台帳に記録する。これにより、誰がいつどのソフトウェアを適用したかを客観的に示せるようになる。

## システム構成

| コンポーネント | 役割およびポイント |
|---------------|------------------|
| サプライヤー／設計情報管理システム (PLM) | 設計情報や納品ソフトウェアを保管する。専用線や VPN を通じてトレーサビリティ API にソフトウェア証拠を提出し、台帳に記録する。 |
| トレーサビリティ API (Spring Boot) | クローズドネットワークと公開ネットワークの境界で動作するマイクロサービス。サプライヤーや工場から受け取った証拠データを ScalarDL Ledger に追記し、更新領域（RDB／NoSQL）にも同時に登録する。ScalarDB の分散トランザクションにより、台帳と検索データベースへの書き込みを同時成立させる。 |
| ScalarDL Ledger サーバー | tamper‑evident な台帳を提供し、証拠データ（ソフトウェアのハッシュ、署名、公開鍵、構成履歴など）を格納する。台帳は複数ノードに分散され、Auditor との相互検証によってビザンチン故障を検知する（参考: [scalardl.scalar-labs.com](https://scalardl.scalar-labs.com)）。 |
| ScalarDL Auditor | Ledger と同じデータを別管理ドメインで保持し、Ledger との整合性を定期的に検証する。Auditor を有効化すると、高いセキュリティを得られるが追加コストが掛かる（参考: [scalardl.scalar-labs.com](https://scalardl.scalar-labs.com)）。 |
| 更新領域データベース (RDB／NoSQL) | VIN や部品番号などで検索できるよう、車両の構成履歴や作業記録を保持する。Ledger への追記と同時に更新されるため整合性が保たれる。 |
| キー管理／認証基盤 | サプライヤー、工場、販売店、車両ごとに秘密鍵・公開鍵を発行し、公開鍵は台帳に登録する。データ送信時は秘密鍵で署名し、API が公開鍵を用いて検証する。秘密鍵漏洩時は新鍵を発行して再署名を行う。 |
| OTA サーバー／診断機 | ソフトウェアパッケージを配信し、車両からの証拠データを受信する。配信前に台帳からハッシュ値を取得して車両に渡す。 |
| 車両・車載ECU | OTA や診断機から受け取ったソフトウェアのハッシュと署名を検証し、更新後に構成情報を収集して署名付きで送信する。必要最小限の台帳照合機能を備え、オフライン時にはローカルキャッシュを利用する。 |
| ディーラー／整備工場 | 診断機を通じて更新作業を実施し、作業記録やオーナー同意を署名付きで送信する。 |
| 運用監視・分析基盤 | ScalarDL の台帳と更新領域 DB からデータを取得し、更新状況の監視、リコール対象の抽出、鍵漏洩時の影響範囲解析を行う。 |

このアーキテクチャはクラウド非依存・データベース非依存であるため、AWS、Azure、OCI など任意のクラウドにデプロイでき、ノード数を増やすことで性能と可用性が線形に向上する（参考: [scalar-labs.com](https://scalar-labs.com)）。

## 導入メリット／ROI

- ソフトウェア納品から車両適用までの全履歴が tamper‑evident な台帳に残るため、法規制やリコール時に客観的な証拠を提示できる。
- 秘密鍵漏洩や不正改造が発覚した場合でも、証拠の再検証と鍵ローテーションのみで対処でき、再配信や大規模リコールのコストを削減。
- スケーラブルな台帳と検索データベースにより、対象車両数が増えてもレスポンスを維持できる。またクラウドやDB に依存しないため、既存の社内システムやOTA サーバーに柔軟に組み込める。

## 類似事例・参考資料

- 自動車業界では、複数の OEM が ScalarDL を用いた SU 法対応の PoC を実施し、ソフトウェア更新の真正性と不正改造検出の効果を確認している。公式サイトでは、ScalarDL が tamper‑evident かつクラウド／データベース非依存の台帳を提供し、強いデータセキュリティと高いスケーラビリティを両立することが説明されている（参考: [scalar-labs.com](https://scalar-labs.com)）。
